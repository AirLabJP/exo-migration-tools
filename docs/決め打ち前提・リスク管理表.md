# 決め打ち前提・リスク管理表

## 目的

受注前・顧客環境未確認の段階で、資料・WBS 上 **決め打ちしている前提** を一覧化し、**現地棚卸しで検証すべき項目** と **前提が崩れた場合の影響** を明示する。お客様からの事前情報は必ずしも正確でないため、**実際に現地で確認する** ことを前提とする。

---

## 1. 前提の扱い方

- **決め打ち**: 顧客ヒアリングや現地確認の前に、資料・設計で「こうなっている」と仮定している項目。
- **検証**: Phase 1 棚卸し（および必要に応じてヒアリング）で **現地確認** し、前提が正しいかどうかを判定する。
- 前提が崩れた場合は、影響範囲を評価し、設計・WBS・見積もりを更新する。

---

## 2. 決め打ち前提一覧

### 2.1 現行メールシステム（Linux / MTA 周り）

| # | 決め打ち項目 | 現状の前提 | 実際が異なる場合の影響 | 検証方法 |
|---|--------------|------------|------------------------|----------|
| 1 | **DMZ と Courier の経路** | 資料上「DMZ SMTP → Courier IMAP」と記載 | 中継 Postfix が存在する場合、棚卸し対象・設定変更対象が増える。設計図・手順の修正が必要 | 棚卸し: DMZ の transport の次のホップ、Courier の受信方式を確認。※[メールフロー再検証](メールフロー再検証_DMZ-Courier経路.md) 参照 |
| 2 | **DMZ / 上位 MTA の製品** | 「10中8〜9は Postfix」と想定 | 別 MTA（Sendmail 等）の場合は、スクリプト・手順がそのまま使えない可能性 | 棚卸し: 各 SMTP 中継サーバーで MTA 種別（postconf -n 等）を確認。collect_smtp_dmz.sh の出力で記録 |
| 3 | **現行構成の WBS 粒度** | 新規流では EXO/Entra/AD の棚卸しは書いてあるが、**現行側（Postfix、上位 MTA、DMZ サーバーに何が載っているか）の具体的な「何を見るか」が WBS に不足** | 棚卸し漏れ→設計ずれ→手戻り | WBS に「現行 MTA 棚卸し」をタスク分解し、確認対象（transport、virtual、中継の有無、Courier への配送経路）を明記 |
| 4 | **内部 DMZ SMTP の稼働** | 資料上「フォールバック用に存在、ほぼ未使用」と記載 | 廃止済み or 役割変更の場合は、フォールバック経路の設計変更が必要 | 棚卸し: 内部 DMZ の有無・役割・transport を現地確認。お客様説明のみに依存しない |

### 2.2 移行先（EXO / Entra / AD）

| # | 決め打ち項目 | 現状の前提 | 実際が異なる場合の影響 | 検証方法 |
|---|--------------|------------|------------------------|----------|
| 5 | **EXO の利用状況** | 「環境はあるが未使用、EWS のみオン」 | 既にメールボックス等がある場合、紛れ検出・クリーンアップが増える | 棚卸し: Collect-EXOInventory.ps1、Detect-StrayRecipients.ps1 |
| 6 | **AD の mail / proxyAddresses** | 「ほぼ空、全件投入が必要」 | 既に一部入っている場合、重複・上書き方針の検討が必要 | 棚卸し: Collect-ADInventory.ps1 |
| 7 | **Entra ID Connect 同期対象** | ユーザー＋セキュリティグループ同期済み | 同期対象や属性が違うと、EXO メールボックス作成フローに影響 | 棚卸し: Collect-EntraInventory.ps1、Collect-EntraConnectInventory.ps1 |

### 2.3 お客様提供情報・スコープ

| # | 決め打ち項目 | 現状の前提 | 実際が異なる場合の影響 | 検証方法 |
|---|--------------|------------|------------------------|----------|
| 8 | **パイロットドメイン** | お客様選定済み・未共有 | 選定されていない場合はスケジュール・設計の前提が変わる | 初回 MTG / ヒアリングで確定 |
| 9 | **移行対象ユーザー一覧** | お客様が CSV で提供可能 | 提供遅延・形式違いで Phase 2 以降が遅れる | テンプレートを事前共有し、受領時期を契約で明示 |
| 10 | **送信セキュリティ（GWC）** | GuardianWall Cloud 導入前提 | 未導入 or 別製品の場合はコネクタ・Transport Rule の設計変更 | ヒアリング＋契約書・設定確認 |

### 2.4 その他

| # | 決め打ち項目 | 現状の前提 | 実際が異なる場合の影響 | 検証方法 |
|---|--------------|------------|------------------------|----------|
| 11 | **お客様の事前説明の正確性** | 資料は「聞き取りベース」で作成 | 実環境と食い違う可能性がある | **全ての重要項目は現地棚卸しで確認する**。説明は仮説として扱う |
| 12 | **期間・リソース** | 2 ヶ月・実質 2 名体制でパイロット完了想定 | 前提が厳しい場合、スコープ削減 or 期間延長の検討が必要 | 受注時・キックオフで再確認 |

---

## 3. 棚卸しで「必ず現地確認する」項目（抜粋）

- **AWS DMZ SMTP**: transport の内容、次のホップの FQDN/IP とその役割（Courier 直 or 中継 MTA）。
- **内部 DMZ SMTP**: 存在・稼働、transport、次のホップ。EXO からの接続可否。
- **内部 Postfix（SMTP ハブ等）**: 台数・役割、transport / virtual、Courier への配送方法。
- **Courier IMAP**: SMTP 25 で受信しているか、local 配送のみか。
- **EXO / Entra / AD**: 上表 2.2 の棚卸しスクリプトで取得する項目。

※ 一覧の詳細は [メールフロー再検証_DMZ-Courier経路.md](メールフロー再検証_DMZ-Courier経路.md) の「棚卸し時の確認事項」を参照。

---

## 4. WBS への反映提案

- **Phase 1 に「現行 MTA 棚卸し」を明示**  
  - タスク例: 「AWS DMZ SMTP の transport と次のホップを確認」「内部 DMZ SMTP の有無・transport を確認」「内部 Postfix（SMTP ハブ）の台数・transport・Courier への配送経路を確認」「Courier の受信方式（25 受信 or local）を確認」  
- **成果物**: 「現行メール経路図（受信・送信・フォールバック）」を棚卸しレポートに含める。  
- 上記を WBS に落とし、見積もり・スケジュールに反映する。

---

## 5. 関連ドキュメント

- [メールフロー再検証_DMZ-Courier経路](メールフロー再検証_DMZ-Courier経路.md)
- [ExchangeOnline移行プロジェクト要件定義書（案）](ExchangeOnline移行プロジェクト要件定義書（案）.md)
- [ExchangeOnline移行プロジェクト基本設計書（案）](ExchangeOnline移行プロジェクト基本設計書（案）.md)

---

## 改訂履歴

| 版 | 日付 | 変更内容 |
|----|------|----------|
| 0.1 | 2026-02-01 | 初版（決め打ち前提の洗い出し、現地確認前提の明示、WBS 反映提案） |

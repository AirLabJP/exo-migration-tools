# セキュリティアプライアンス棚卸し手順

## 概要

GuardianWall（オンプレ版）およびFireEYEは専用アプライアンス製品であり、スクリプトでの自動収集が困難です。
本手順書では、各製品の管理画面から設定・ポリシー情報をエクスポートする手順を記載します。

---

## 1. GuardianWall（オンプレ版）棚卸し手順

### 1.1. 事前準備

- **必要な権限**: GuardianWall管理者権限
- **アクセス方法**: 管理画面 HTTPS接続
- **出力先フォルダ**: `inventory/guardianwall_YYYYMMDD/`

### 1.2. エクスポート手順

#### ステップ1: 管理画面ログイン

1. ブラウザでGuardianWall管理画面にアクセス
   - URL: `https://<GuardianWall-IP>/admin/` （環境により異なる）
2. 管理者アカウントでログイン

#### ステップ2: システム設定のエクスポート

**メニュー: システム管理 > バックアップ/復元**

1. 「設定のバックアップ」をクリック
2. バックアップ範囲を選択：
   - [x] ネットワーク設定
   - [x] メールフィルタリング設定
   - [x] アンチスパム設定
   - [x] アンチウイルス設定
   - [x] 検疫設定
   - [x] ユーザー/グループ設定
   - [x] ログ設定
3. 「バックアップ実行」をクリック
4. 生成されたファイル（`guardianwall_backup_YYYYMMDD.tar.gz`）をダウンロード

**保存先**: `inventory/guardianwall_YYYYMMDD/system_backup.tar.gz`

#### ステップ3: ポリシー設定の手動記録

以下の設定を画面キャプチャまたは手動で記録：

**メニュー: メールフィルタリング > ポリシー設定**

取得すべき情報：
- **受信ポリシー一覧**
  - ポリシー名
  - 適用条件（ドメイン、ユーザー）
  - スパムスコア閾値
  - ウイルススキャン設定
  - 添付ファイルフィルタ設定
  - アクション（配送/検疫/破棄）

- **送信ポリシー一覧**
  - ポリシー名
  - 適用条件
  - DLP（情報漏洩防止）設定
  - 添付ファイル制限

**出力形式**: スクリーンショット + CSV（手動作成）

**保存先**:
- `inventory/guardianwall_YYYYMMDD/screenshots/`
- `inventory/guardianwall_YYYYMMDD/policies.csv`

#### ステップ4: ホワイトリスト/ブラックリストの取得

**メニュー: メールフィルタリング > ホワイトリスト/ブラックリスト**

1. 「エクスポート」ボタンをクリック（機能がある場合）
2. CSV形式でダウンロード
3. 機能がない場合は画面コピー

**保存先**: `inventory/guardianwall_YYYYMMDD/whitelist_blacklist.csv`

#### ステップ5: 検疫メール統計の取得

**メニュー: レポート > 検疫メール統計**

1. 期間を指定（例：過去3ヶ月）
2. 「レポート生成」をクリック
3. PDF/CSV形式でダウンロード

**保存先**: `inventory/guardianwall_YYYYMMDD/quarantine_stats.pdf`

#### ステップ6: ログ設定の確認

**メニュー: システム管理 > ログ設定**

記録すべき情報：
- ログ保存期間
- ログ転送先（Syslog等）
- ログローテーション設定

**保存方法**: スクリーンショット

**保存先**: `inventory/guardianwall_YYYYMMDD/screenshots/log_settings.png`

### 1.3. 収集完了チェックリスト

- [ ] システム設定バックアップファイル取得
- [ ] 受信ポリシー一覧（CSV/スクリーンショット）
- [ ] 送信ポリシー一覧（CSV/スクリーンショット）
- [ ] ホワイトリスト/ブラックリスト
- [ ] 検疫メール統計レポート
- [ ] ログ設定スクリーンショット

---

## 2. FireEYE棚卸し手順

### 2.1. 事前準備

- **必要な権限**: FireEYE管理者権限
- **アクセス方法**: 管理画面 HTTPS接続
- **出力先フォルダ**: `inventory/fireeye_YYYYMMDD/`

### 2.2. エクスポート手順

#### ステップ1: 管理画面ログイン

1. ブラウザでFireEYE管理画面にアクセス
   - URL: `https://<FireEYE-IP>/` （環境により異なる）
2. 管理者アカウントでログイン

#### ステップ2: システム設定のバックアップ

**メニュー: Settings > Backup and Restore**

1. 「Backup Configuration」をクリック
2. バックアップタイプを選択：
   - Configuration Only
   - Configuration and Logs（必要に応じて）
3. 「Start Backup」をクリック
4. 完了後、ダウンロード

**保存先**: `inventory/fireeye_YYYYMMDD/system_backup.tar.gz`

#### ステップ3: Email Securityポリシーのエクスポート

**メニュー: Email Security > Policies**

1. 「Export All Policies」をクリック（機能がある場合）
2. XML/JSON形式でダウンロード
3. 機能がない場合は各ポリシーを個別にエクスポート

取得すべきポリシー：
- **Anti-Spam Policies**
  - ポリシー名
  - スパムスコア閾値
  - 適用ルール
  - アクション

- **Anti-Malware Policies**
  - ポリシー名
  - スキャンエンジン設定
  - 検疫設定
  - アクション

- **URL Filtering Policies**
  - ポリシー名
  - URLカテゴリ設定
  - ブロック/許可リスト

**保存先**:
- `inventory/fireeye_YYYYMMDD/policies/anti_spam.xml`
- `inventory/fireeye_YYYYMMDD/policies/anti_malware.xml`
- `inventory/fireeye_YYYYMMDD/policies/url_filtering.xml`

#### ステップ4: ルール設定の取得

**メニュー: Email Security > Rules**

1. 「Export Rules」をクリック
2. すべてのルールを含むファイルをダウンロード

**保存先**: `inventory/fireeye_YYYYMMDD/email_rules.xml`

#### ステップ5: ホワイトリスト/ブラックリストの取得

**メニュー: Email Security > Allow/Block Lists**

1. 「Export」をクリック
2. CSV形式でダウンロード

取得すべきリスト：
- Sender Allow List
- Sender Block List
- Domain Allow List
- Domain Block List
- IP Allow List
- IP Block List

**保存先**: `inventory/fireeye_YYYYMMDD/allow_block_lists.csv`

#### ステップ6: アラート設定の取得

**メニュー: Alerts > Alert Configuration**

1. 各アラートルールをスクリーンショット
2. または「Export Alert Rules」（機能がある場合）

**保存先**:
- `inventory/fireeye_YYYYMMDD/alerts/`
- `inventory/fireeye_YYYYMMDD/alert_rules.xml`

#### ステップ7: レポート生成

**メニュー: Reports**

以下のレポートを生成・ダウンロード：

1. **Executive Summary Report**
   - 期間: 過去3ヶ月
   - 形式: PDF

2. **Email Activity Report**
   - 期間: 過去3ヶ月
   - 形式: PDF/CSV

3. **Threat Activity Report**
   - 期間: 過去3ヶ月
   - 形式: PDF

**保存先**: `inventory/fireeye_YYYYMMDD/reports/`

#### ステップ8: システム情報の取得

**メニュー: Settings > System Information**

記録すべき情報：
- FireEYEバージョン
- ライセンス情報
- ネットワーク設定
- 統合設定（AD/LDAP/API等）

**保存方法**: スクリーンショット + 手動記録

**保存先**: `inventory/fireeye_YYYYMMDD/system_info.txt`

### 2.3. 収集完了チェックリスト

- [ ] システム設定バックアップファイル取得
- [ ] Email Securityポリシー（Anti-Spam/Anti-Malware/URL Filtering）
- [ ] ルール設定ファイル
- [ ] ホワイトリスト/ブラックリスト
- [ ] アラート設定
- [ ] レポート（Executive Summary/Email Activity/Threat Activity）
- [ ] システム情報

---

## 3. 棚卸し後の確認事項

### 3.1. ファイル整理

取得したファイルを以下の構造で整理：

```
inventory/
├── guardianwall_YYYYMMDD/
│   ├── system_backup.tar.gz
│   ├── policies.csv
│   ├── whitelist_blacklist.csv
│   ├── quarantine_stats.pdf
│   └── screenshots/
│       ├── policy_*.png
│       └── log_settings.png
└── fireeye_YYYYMMDD/
    ├── system_backup.tar.gz
    ├── policies/
    │   ├── anti_spam.xml
    │   ├── anti_malware.xml
    │   └── url_filtering.xml
    ├── email_rules.xml
    ├── allow_block_lists.csv
    ├── alerts/
    ├── reports/
    │   ├── executive_summary.pdf
    │   ├── email_activity.pdf
    │   └── threat_activity.pdf
    └── system_info.txt
```

### 3.2. 移行時の参照用途

**GuardianWall設定 → EXO設定への対応付け:**

| GuardianWall設定 | EXO対応機能 |
|---|---|
| スパムフィルタリング | Exchange Online Protection (EOP) Anti-Spam Policies |
| ウイルススキャン | EOP Anti-Malware Policies |
| 添付ファイルフィルタ | Safe Attachments (Defender for Office 365) |
| 検疫設定 | EOP Quarantine Policies |
| DLP設定 | Microsoft Purview DLP Policies |

**FireEYE設定 → EXO設定への対応付け:**

| FireEYE設定 | EXO対応機能 |
|---|---|
| Anti-Spam Policies | EOP Anti-Spam Policies |
| Anti-Malware Policies | EOP Anti-Malware Policies |
| URL Filtering | Safe Links (Defender for Office 365) |
| Sandbox Analysis | Safe Attachments Dynamic Delivery |
| Threat Intelligence | Microsoft Defender Threat Intelligence |

### 3.3. 注意事項

1. **バックアップファイルの取り扱い**
   - 暗号化して保管
   - アクセス権限を制限
   - 移行完了後は適切に廃棄

2. **機密情報の保護**
   - 管理者パスワードは含めない
   - API キーは別途管理

3. **バージョン管理**
   - 収集日時を必ず記録
   - 複数回収集する場合は日付でフォルダ分け

---

## 4. トラブルシューティング

### 4.1. エクスポート機能が見つからない場合

**対処法:**
1. 製品マニュアルで該当機能を確認
2. ベンダーサポートに問い合わせ
3. 代替として画面キャプチャ + 手動CSV作成

### 4.2. バックアップファイルが大きすぎる場合

**対処法:**
1. 「設定のみ」でバックアップ（ログを除外）
2. 圧縮形式を確認（tar.gz推奨）
3. 分割ダウンロード（可能であれば）

### 4.3. 権限不足エラーが出る場合

**対処法:**
1. 管理者権限の再確認
2. ベンダーサポートに権限昇格を依頼
3. システム管理者に作業を依頼

---

## 5. 補足：スクリプト化が困難な理由

### GuardianWall
- 専用アプライアンスのため、SSH/CLI アクセスが制限されている
- 公開APIが提供されていない（または限定的）
- 管理画面（Web UI）からの操作が唯一の手段

### FireEYE
- REST API は存在するが、以下の課題がある：
  - 認証トークンの取得が複雑
  - APIバージョンごとに仕様が異なる
  - 設定変更権限とエクスポート権限が分離されている
  - エンタープライズ契約が必要な場合がある
- 管理画面からのエクスポートが最も確実

---

## 6. 参考リンク

- GuardianWall 管理者ガイド（製品マニュアル参照）
- FireEYE Email Security 管理者ガイド（製品マニュアル参照）
- Microsoft Defender for Office 365 機能対応表

---

**作成日**: 2026-01-23
**作成者**: EXO移行プロジェクトチーム
**バージョン**: 1.0
